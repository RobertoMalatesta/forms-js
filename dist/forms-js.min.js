!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.formsjs=t()}(this,function(){var e;!function(e){var t=function(){function t(t,i){this.fieldName_=i,this.form_=t,this.disabled_=!1,this.errorMessages_=[],this.pristine_=!0,this.uuid_=e.UID.create()}return Object.defineProperty(t.prototype,"disabled",{get:function(){return this.disabled_},set:function(e){this.disabled_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorMessages",{get:function(){return this.errorMessages_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"form",{get:function(){return this.form_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pristine",{get:function(){return this.pristine_},set:function(e){this.pristine_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"required",{get:function(){var e=this.form_.validationSchema[this.fieldName_];return e&&e.required},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.errorMessages_=[],this.pristine_=!0},t.prototype.validate=function(){var e=this,t=this.form_.validationService.validateField(this.fieldName_,this.form_.formData,this.form_.validationSchema);return t.then(function(){e.errorMessages_=[]},function(t){e.errorMessages_=t}),t},t}();e.AttributeMetadata=t}(e||(e={}));var e;!function(e){var t=function(){function t(){this.fieldNameToAttributeMetadata_={},this.formData_={},this.strings_=new e.Strings,this.validationService_=new e.ValidationService(this.strings_)}return Object.defineProperty(t.prototype,"disabled",{get:function(){return this.disabled_},set:function(e){var t=this;this.disabled_=e,Object.keys(this.fieldNameToAttributeMetadata_).forEach(function(i){var a=t.fieldNameToAttributeMetadata_[i];a.disabled=e})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formData",{get:function(){return this.formData_},set:function(e){this.formData_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strings",{get:function(){return this.strings_},set:function(e){this.strings_=e,this.validationService_.strings=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"submitFunction",{get:function(){return this.submitFunction_},set:function(e){this.submitFunction_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"validationSchema",{get:function(){return this.validationSchema_},set:function(e){this.validationSchema_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"validationService",{get:function(){return this.validationService_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewSchema",{get:function(){return this.viewSchema_},set:function(e){this.viewSchema_=e},enumerable:!0,configurable:!0}),t.prototype.registerAttribute=function(t){if(this.fieldNameToAttributeMetadata_[t])throw Error('Attribute "'+t+'" has already been registered');var i=new e.AttributeMetadata(this,t);return this.fieldNameToAttributeMetadata_[t]=i,i},t.prototype.submitIfValid=function(){var e=this;return this.submitFunction_?(this.disabled=!0,new Promise(function(t,i){e.validate(!0).then(function(){e.submitFunction_(e.formData).then(function(){e.disabled=!1,t()},function(t){e.processFieldNameToErrorMap_(t,!0),e.disabled=!1,i()})},function(){e.disabled=!1})})):Promise.reject("No submit function provided")},t.prototype.unregisterAttribute=function(e){delete this.fieldNameToAttributeMetadata_[e]},t.prototype.validate=function(e){var t=this,i=[];Object.keys(this.fieldNameToAttributeMetadata_).forEach(function(e){var a=t.fieldNameToAttributeMetadata_[e];i.push(a.validate())});var a=Promise.all(i);return a.then(function(){},function(i){t.processFieldNameToErrorMap_(i,e)}),a},t.prototype.processFieldNameToErrorMap_=function(t,i){if("object"==typeof t)for(var a=e.Flatten.flatten(t),n=0,r=a.length;r>n;n++){var o=a[n],s=this.fieldNameToAttributeMetadata_[o],l=t[o];s&&(Array.isArray(l)?s.errorMessages=l:"string"==typeof l&&(s.errorMessages=[l]),i&&(s.pristine=!1))}},t}();e.Form=t}(e||(e={}));var e;!function(e){var t=function(){function e(){this.arrayTypeValidationFailed_=e.arrayTypeValidationFailed,this.booleanTypeValidationFailed_=e.booleanTypeValidationFailed,this.customValidationFailed_=e.customValidationFailed,this.enumerationValidationFailed_=e.enumerationValidationFailed,this.floatTypeValidationFailed_=e.floatTypeValidationFailed,this.integerTypeValidationFailed_=e.integerTypeValidationFailed,this.maximumNumberValidationFailed_=e.maximumNumberValidationFailed,this.maxArrayLengthValidationFailed_=e.maxArrayLengthValidationFailed,this.maxStringLengthValidationFailed_=e.maxStringLengthValidationFailed,this.minimumNumberValidationFailed_=e.minimumNumberValidationFailed,this.minArrayLengthValidationFailed_=e.minArrayLengthValidationFailed,this.minStringLengthValidationFailed_=e.minStringLengthValidationFailed,this.patternValidationFailed_=e.patternValidationFailed,this.requiredValidationFailed_=e.requiredValidationFailed,this.stringTypeValidationFailed_=e.stringTypeValidationFailed}return Object.defineProperty(e.prototype,"arrayTypeValidationFailed",{get:function(){return this.arrayTypeValidationFailed_},set:function(e){this.arrayTypeValidationFailed_=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"booleanTypeValidationFailed",{get:function(){return this.booleanTypeValidationFailed_},set:function(e){this.booleanTypeValidationFailed_=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"customValidationFailed",{get:function(){return this.customValidationFailed_},set:function(e){this.customValidationFailed_=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enumerationValidationFailed",{get:function(){return this.enumerationValidationFailed_},set:function(e){this.enumerationValidationFailed_=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"floatTypeValidationFailed",{get:function(){return this.floatTypeValidationFailed_},set:function(e){this.floatTypeValidationFailed_=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"integerTypeValidationFailed",{get:function(){return this.integerTypeValidationFailed_},set:function(e){this.integerTypeValidationFailed_=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumNumberValidationFailed",{get:function(){return this.maximumNumberValidationFailed_},set:function(e){this.maximumNumberValidationFailed_=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxArrayLengthValidationFailed",{get:function(){return this.maxArrayLengthValidationFailed_},set:function(e){this.maxArrayLengthValidationFailed_=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxStringLengthValidationFailed",{get:function(){return this.maxStringLengthValidationFailed_},set:function(e){this.maxStringLengthValidationFailed_=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minimumNumberValidationFailed",{get:function(){return this.minimumNumberValidationFailed_},set:function(e){this.minimumNumberValidationFailed_=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minArrayLengthValidationFailed",{get:function(){return this.minArrayLengthValidationFailed_},set:function(e){this.minArrayLengthValidationFailed_=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minStringLengthValidationFailed",{get:function(){return this.minStringLengthValidationFailed_},set:function(e){this.minStringLengthValidationFailed_=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"patternValidationFailed",{get:function(){return this.patternValidationFailed_},set:function(e){this.patternValidationFailed_=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"requiredValidationFailed",{get:function(){return this.requiredValidationFailed_},set:function(e){this.requiredValidationFailed_=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stringTypeValidationFailed",{get:function(){return this.stringTypeValidationFailed_},set:function(e){this.stringTypeValidationFailed_=e},enumerable:!0,configurable:!0}),e.arrayTypeValidationFailed="${value} must be an array.",e.booleanTypeValidationFailed="${value} must be a boolean.",e.customValidationFailed="Value ${value} failed custom validation.",e.enumerationValidationFailed="The value for ${value} is not in the list of allowed values",e.floatTypeValidationFailed="${value} must be a float.",e.integerTypeValidationFailed="${value} must be an integer.",e.maximumNumberValidationFailed="Must be no more than ${max}.",e.maxArrayLengthValidationFailed="Must contain no more than ${max} items.",e.maxStringLengthValidationFailed="Must be no more than ${max} characters long.",e.minimumNumberValidationFailed="Must be at least ${min}.",e.minArrayLengthValidationFailed="Must contain at least ${max} items.",e.minStringLengthValidationFailed="Must be at least ${min} characters long.",e.patternValidationFailed="The value for ${value} does not match the required pattern",e.requiredValidationFailed="This is a required field.",e.stringTypeValidationFailed="${value} must be a string.",e}();e.Strings=t}(e||(e={}));var e;!function(e){!function(e){e[e.CHECKBOX="checkbox"]="CHECKBOX",e[e.RADIO="radio"]="RADIO",e[e.TEXT="text"]="TEXT"}(e.InputType||(e.InputType={}));e.InputType}(e||(e={}));var e;!function(e){!function(e){e[e.ARRAY="array"]="ARRAY",e[e.BOOLEAN="boolean"]="BOOLEAN",e[e.FLOAT="float"]="FLOAT",e[e.INTEGER="integer"]="INTEGER",e[e.STRING="string"]="STRING"}(e.ValidationType||(e.ValidationType={}));e.ValidationType}(e||(e={}));var e;!function(e){var t=function(){function e(){}return e.flatten=function(e){for(var t=[],i=[{object:e,prefix:null}];;){if(0===i.length)break;var a=i.pop(),n=Array.isArray(a.object),r=a.prefix?a.prefix+(n?"[":"."):"",o=n?"]":"";if("object"==typeof a.object)for(var s in a.object){var l=r+s+o,u=a.object[s];t.push(l),i.push({object:u,prefix:l})}}return t},e.read=function(e,t){for(var i=e.split(/[\.\[\]]/);i.length>0;){var a=i.shift();if(a){if(a.match(/^[0-9]+$/)&&(a=parseInt(a)),!t.hasOwnProperty(a))return void 0;t=t[a]}}return t},e.write=function(e,t,i){for(var a,n=0,r=0,o=t.length;o>r;r++){var s=t.charAt(r);switch(s){case"[":a=t.substring(n,r),this.createPropertyIfMissing_(a,i,Array);break;case"]":if(a=t.substring(n,r),a=parseInt(a),r===o-1)i[a]=e;else{if(!i[a]&&o-1>r)switch(t.charAt(r+1)){case"[":i[a]=[];break;case".":i[a]={}}i=i[a]}break;case".":a=t.substring(n,r),a&&this.createPropertyIfMissing_(a,i,Object);break;default:continue}n=r+1,a&&(i=i[a])}n<t.length&&(a=t.substring(n,t.length),i[a]=e)},e.createPropertyIfMissing_=function(e,t,i){switch(i){case Array:if(t.hasOwnProperty(e)){if(!(t[e]instanceof Array))throw Error("Property already exists but is not an Array")}else t[e]=[];break;case Object:if(t.hasOwnProperty(e)){if("object"!=typeof t[e])throw Error("Property already exists but is not an Object")}else t[e]={};break;default:throw Error("Unsupported property type")}},e}();e.Flatten=t}(e||(e={}));var e;!function(e){var t=function(){function e(){}return e.humanize=function(e){return e?(e=e.replace(/[A-Z]/g,function(e){return" "+e}),e=e.replace(/_([a-z])/g,function(e,t){return" "+t.toUpperCase()}),e=e.replace(/\s+/g," "),e=e.trim(),e=e.charAt(0).toUpperCase()+e.slice(1)):""},e}();e.Humanizer=t}(e||(e={}));var e;!function(e){var t=function(){function e(){}return e.create=function(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)},e}();e.UID=t}(e||(e={}));var e;!function(e){var t=function(){function e(e){this.promises_=e||[],this.failureMessages_=[]}return e.prototype.add=function(e){var t=this;return e.forEach(function(e){t.promises_.push(e),e.then(function(){t.markCompleted_(e),t.checkForCompletion_()},function(i){t.failureMessages_.push(i),t.markCompleted_(e),t.checkForCompletion_()})}),this},e.prototype.build=function(){var e=this;return this.promise_=new Promise(function(t,i){e.promiseResolver_=t,e.promiseRejecter_=i}),this.checkForCompletion_(),this.promise_},e.prototype.checkForCompletion_=function(){this.promise_&&0===this.promises_.length&&(this.failureMessages_.length>0?this.promiseRejecter_(this.failureMessages_):this.promiseResolver_())},e.prototype.markCompleted_=function(e){this.promises_.splice(this.promises_.indexOf(e),1)},e}();e.ValidationPromiseBuilder=t}(e||(e={}));var e;!function(e){var t=function(){function t(t){this.strings_=t||new e.Strings}return Object.defineProperty(t.prototype,"strings",{get:function(){return this.strings_},set:function(e){this.strings_=e},enumerable:!0,configurable:!0}),t.prototype.validateField=function(t,i,a){var n,r=e.Flatten.read(t,i),o=e.Flatten.read(t,a);return n=o?(new e.ValidationPromiseBuilder).add(new e.RequiredValidator(this.strings).validate(r,i,o)).add(new e.TypeValidator(this.strings).validate(r,i,o)).add(new e.MinMaxValidator(this.strings).validate(r,i,o)).add(new e.EnumValidator(this.strings).validate(r,i,o)).add(new e.PatternValidator(this.strings).validate(r,i,o)).add(new e.CustomValidator(this.strings).validate(r,i,o)).build():Promise.resolve()},t}();e.ValidationService=t}(e||(e={}));var e;!function(e){var t=function(){function t(t){this.strings_=t||new e.Strings}return Object.defineProperty(t.prototype,"strings",{get:function(){return this.strings_},set:function(e){this.strings_=e},enumerable:!0,configurable:!0}),t.prototype.validate=function(){throw Error("Abstract validate method must be overridden.")},t}();e.AbstractValidator=t}(e||(e={}));var e,t=this.__extends||function(e,t){function i(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);i.prototype=t.prototype,e.prototype=new i};!function(e){var i=function(e){function i(){e.apply(this,arguments)}return t(i,e),i.prototype.validate=function(e,t,i){var a=this,n=[];return i.validators&&i.validators.forEach(function(i){var r=i(e,t);r instanceof Promise?n.push(new Promise(function(t,i){r.then(function(){t()},function(t){var n=t||a.strings.customValidationFailed;n=n.replace("${value}",e),i(n)})})):"string"==typeof r&&r?n.push(Promise.reject(r)):r||n.push(Promise.reject(a.strings.customValidationFailed.replace("${value}",e)))}),n},i}(e.AbstractValidator);e.CustomValidator=i}(e||(e={}));var e;!function(e){var i=function(e){function i(){e.apply(this,arguments)}return t(i,e),i.prototype.validate=function(e,t,i){var a=[];if(i.enumeration&&i.enumeration.indexOf(e)<0){var n=i.enumerationFailureMessage||this.strings.enumerationValidationFailed;n=n.replace("${value}",e),a.push(Promise.reject(n))}return a},i}(e.AbstractValidator);e.EnumValidator=i}(e||(e={}));var e;!function(e){var i=function(i){function a(){i.apply(this,arguments)}return t(a,i),a.prototype.validate=function(t,i,a){var n,r=[];return a.min&&(n=a.type===e.ValidationType.ARRAY&&t&&t.length<a.min?a.minFailureMessage||this.strings.minArrayLengthValidationFailed:"string"==typeof t&&t.length<a.min?a.minFailureMessage||this.strings.minStringLengthValidationFailed:"number"==typeof t&&t<a.min?a.minFailureMessage||this.strings.minimumNumberValidationFailed:null,n&&(n=n.replace("${value}",t).replace("${min}",a.min),r.push(Promise.reject(n)))),a.max&&(n=a.type===e.ValidationType.ARRAY&&t&&t.length>a.max?a.maxFailureMessage||this.strings.maxArrayLengthValidationFailed:"string"==typeof t&&t.length>a.max?a.maxFailureMessage||this.strings.maxStringLengthValidationFailed:"number"==typeof t&&t>a.max?a.maxFailureMessage||this.strings.maximumNumberValidationFailed:null,n&&(n=n.replace("${value}",t).replace("${max}",a.max),r.push(Promise.reject(n)))),r},a}(e.AbstractValidator);e.MinMaxValidator=i}(e||(e={}));var e;!function(e){var i=function(e){function i(){e.apply(this,arguments)}return t(i,e),i.prototype.validate=function(e,t,i){var a=[];if(i.pattern&&!i.pattern.exec(e)){var n=i.patternFailureMessage||this.strings.patternValidationFailed;n=n.replace("${value}",e),a.push(Promise.reject(n))}return a},i}(e.AbstractValidator);e.PatternValidator=i}(e||(e={}));var e;!function(e){var i=function(e){function i(){e.apply(this,arguments)}return t(i,e),i.prototype.validate=function(e,t,i){var a=[];return i.required&&!e&&a.push(Promise.reject(i.requiredFailureMessage||this.strings.requiredValidationFailed)),a},i}(e.AbstractValidator);e.RequiredValidator=i}(e||(e={}));var e;return function(e){var i=function(i){function a(){i.apply(this,arguments)}return t(a,i),a.prototype.validate=function(t,i,a){var n=[];if(a.type){var r,o=void 0!==t&&null!==t?t.toString():void 0,s=Number(t);switch(a.type){case e.ValidationType.ARRAY:o&&!Array.isArray(t)&&(r=a.typeFailureMessage||this.strings.arrayTypeValidationFailed,r=r.replace("${value}",t),n.push(Promise.reject(r)));break;case e.ValidationType.BOOLEAN:o&&"true"!=o&&"false"!=o&&(r=a.typeFailureMessage||this.strings.booleanTypeValidationFailed,r=r.replace("${value}",t),n.push(Promise.reject(r)));break;case e.ValidationType.FLOAT:o&&isNaN(s)&&(r=a.typeFailureMessage||this.strings.floatTypeValidationFailed,r=r.replace("${value}",t),n.push(Promise.reject(r)));break;case e.ValidationType.INTEGER:o&&(isNaN(s)||s%1!==0)&&(r=a.typeFailureMessage||this.strings.integerTypeValidationFailed,r=r.replace("${value}",t),n.push(Promise.reject(r)));break;case e.ValidationType.STRING:default:o&&"string"!=typeof t&&(r=a.typeFailureMessage||this.strings.stringTypeValidationFailed,r=r.replace("${value}",t),n.push(Promise.reject(r)))}}return n},a}(e.AbstractValidator);e.TypeValidator=i}(e||(e={})),e});
//# sourceMappingURL=forms-js.min.js.map